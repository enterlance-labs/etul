# Enterlance Telegram User Logger (ETUL)

ETUL ‚Äî —ç—Ç–æ Telegram userbot, –∫–æ—Ç–æ—Ä—ã–π –ª–æ–≥–∏—Ä—É–µ—Ç –¥–µ–π—Å—Ç–≤–∏—è ¬´typing/–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å¬ª –∏–∑ –ª–∏—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –∏ –≥—Ä—É–ø–ø –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π –ª–æ–≥‚Äë—á–∞—Ç (–æ–±—è–∑–∞—Ç–µ–ª–Ω—å–æ —Å—É–ø–µ—Ä–≥—Ä—É–ø–ø–∞ —Å —Ç–æ–ø–∏–∫–∞–º–∏). –î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è/–≥—Ä—É–ø–ø—ã —Å–æ–∑–¥–∞—ë—Ç—Å—è —Å–≤–æ–π —Ç–æ–ø–∏–∫, —á—Ç–æ–±—ã –±—ã–ª–æ —É–¥–æ–±–Ω–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å. –ë—É–¥—É –±–ª–∞–≥–æ–¥–∞—Ä–µ–Ω –∑–∞ —Å–æ–¥–µ–π—Å—Ç–≤–∏–µ –≤ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –±–∞–≥–æ–≤ –≤ pull requests/issues ‚ù§Ô∏è‚Äçü©π

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
- –õ–æ–≥–∏—Ä—É–µ—Ç typing/–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –≤ –õ–° –∏ –≥—Ä—É–ø–ø–∞—Ö (–≤ –≥—Ä—É–ø–ø–∞—Ö –ø–æ–∫–∞ –ø–ª–æ—Ö–æ).
- –°–æ–∑–¥–∞—ë—Ç –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ç–æ–ø–∏–∫–∏ –≤ –ª–æ–≥‚Äë—á–∞—Ç–µ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è/–≥—Ä—É–ø–ø—ã.
- –ê–≤—Ç–æ‚Äë–ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Ç–æ–ø–∏–∫–æ–≤ –ø—Ä–∏ –ø–æ—è–≤–ª–µ–Ω–∏–∏ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–≥–æ –∏–º–µ–Ω–∏/username.
- –î–µ–±–∞—É–Ω—Å, —á—Ç–æ–±—ã –Ω–µ —Å–ø–∞–º–∏—Ç—å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º–∏ —Å–æ–±—ã—Ç–∏—è–º–∏.
- –ë–µ–ª—ã–π —Å–ø–∏—Å–æ–∫ –≥—Ä—É–ø–ø —á–µ—Ä–µ–∑ `WHITELIST_SOURCE_CHAT_IDS`.

## –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç
- Userbot (—á–µ—Ä–µ–∑ StringSession) —Å–ª—É—à–∞–µ—Ç –∞–ø–¥–µ–π—Ç—ã.
- –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–æ–±—ã—Ç–∏—è typing —Å–æ–∑–¥–∞—ë—Ç—Å—è/–æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Ç–æ–ø–∏–∫ –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –ª–æ–≥‚Äë—á–∞—Ç.
- –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è —É–¥–∞–ª—ë–Ω–Ω—ã–µ —Ç–æ–ø–∏–∫–∏ –∏ —á–∏—Å—Ç–∏—Ç—Å—è –ë–î.

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
- Node.js 18+ (–∏–ª–∏ Bun –≤–Ω—É—Ç—Ä–∏ Docker).
- PostgreSQL (–µ—Å–ª–∏ –ª–æ–∫–∞–ª—å–Ω–æ).
- –ê–∫–∫–∞—É–Ω—Ç Telegram (–¥–ª—è userbot) –∏ –±–æ—Ç –æ—Ç BotFather.

## –°–æ–∑–¥–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ my.telegram.org
1) –û—Ç–∫—Ä–æ–π https://my.telegram.org
2) –í–æ–π–¥–∏ –≤ —Å–≤–æ–π Telegram –∞–∫–∫–∞—É–Ω—Ç.
3) –ü–µ—Ä–µ–π–¥–∏ –≤ **API development tools**.
4) –°–æ–∑–¥–∞–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ –ø–æ–ª—É—á–∏ `API_ID` –∏ `API_HASH`.

## –°–æ–∑–¥–∞—Ç—å –±–æ—Ç–∞ —á–µ—Ä–µ–∑ BotFather
1) –û—Ç–∫—Ä–æ–π @BotFather –≤ Telegram.
2) –ö–æ–º–∞–Ω–¥–∞ `/newbot` ‚Üí –ø—Ä–∏–¥—É–º–∞–π –∏–º—è/username.
3) –°–æ—Ö—Ä–∞–Ω–∏ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ ‚Üí —ç—Ç–æ `BOT_TOKEN`.
4) –î–æ–±–∞–≤—å –±–æ—Ç–∞ –≤ –ª–æ–≥‚Äë–≥—Ä—É–ø–ø—É –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.

## –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å StringSession
–í –ø—Ä–æ–µ–∫—Ç–µ –µ—Å—Ç—å —Å–∫—Ä–∏–ø—Ç `generate_ss.ts`.

1) –ó–∞–ø–æ–ª–Ω–∏ `.env` –º–∏–Ω–∏–º–∞–ª—å–Ω–æ `API_ID` –∏ `API_HASH`.
2) –ó–∞–ø—É—Å—Ç–∏:

```bash
pnpm install
pnpm tsx generate_ss.ts
```

3) –°–ª–µ–¥—É–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –≤ –∫–æ–Ω—Å–æ–ª–∏ (—Ç–µ–ª–µ—Ñ–æ–Ω, –∫–æ–¥, 2FA).
4) –°–∫–æ–ø–∏—Ä—É–π –ø–æ–ª—É—á–µ–Ω–Ω—É—é —Å—Ç—Ä–æ–∫—É –≤ `STRING_SESSION`.

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ .env
–°–º–æ—Ç—Ä–∏ –ø—Ä–∏–º–µ—Ä –≤ `.env.example`. –û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–ª—è:
- `API_ID`, `API_HASH` ‚Äî —Å my.telegram.org
- `BOT_TOKEN` ‚Äî –æ—Ç BotFather
- `LOG_CHAT_ID` ‚Äî id –ª–æ–≥‚Äë—á–∞—Ç–∞ (—Å—É–ø–µ—Ä–≥—Ä—É–ø–ø–∞ —Å —Ç–æ–ø–∏–∫–∞–º–∏)
- `WHITELIST_SOURCE_CHAT_IDS` ‚Äî —Å–ø–∏—Å–æ–∫ id –≥—Ä—É–ø–ø —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é (–ø—É—Å—Ç–æ = –≤—Å–µ)
- `DEBOUNCE_SECONDS` ‚Äî –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö —Å–æ–±—ã—Ç–∏–π
- `DATABASE_URL` ‚Äî —Å—Ç—Ä–æ–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Postgres
- `STRING_SESSION` ‚Äî —Å—Ç—Ä–æ–∫–∞ —Å–µ—Å—Å–∏–∏ userbot

–ü—Ä–∏–º–µ—Ä `DATABASE_URL` –¥–ª—è docker‚Äëcompose:
```
DATABASE_URL="postgresql://postgres:postgres@etul-db:5425/etul?schema=public"
```

## –ó–∞–ø—É—Å–∫ –ª–æ–∫–∞–ª—å–Ω–æ (–±–µ–∑ Docker)
1) –ü–æ–¥–Ω–∏–º–∏ PostgreSQL –∏ —Å–æ–∑–¥–∞–π –ë–î (–Ω–∞–ø—Ä–∏–º–µ—Ä `etul`).
2) –£–∫–∞–∂–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π `DATABASE_URL`.
3) –£—Å—Ç–∞–Ω–æ–≤–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ –Ω–∞–∫–∞—Ç–∏ —Å—Ö–µ–º—É:

```bash
pnpm install
pnpm prisma db push
```

4) –ó–∞–ø—É—Å–∫:

```bash
pnpm dev
```

## –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker
1) –ó–∞–ø–æ–ª–Ω–∏ `.env`.
2) –°–æ–±–µ—Ä–∏ –∏ –∑–∞–ø—É—Å—Ç–∏:

```bash
docker compose build
docker compose up -d
```

## –ü—Ä–∏–º–µ—á–∞–Ω–∏—è
- `WHITELIST_SOURCE_CHAT_IDS` –Ω—É–∂–µ–Ω, —á—Ç–æ–±—ã –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –≥—Ä—É–ø–ø—ã.
- –ï—Å–ª–∏ —Ç–æ–ø–∏–∫ —É–¥–∞–ª—ë–Ω –≤—Ä—É—á–Ω—É—é, –æ–Ω –±—É–¥–µ—Ç —É–¥–∞–ª—ë–Ω –∏–∑ –ë–î –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–π –ø—Ä–æ–≤–µ—Ä–∫–µ.
- –°–µ–π—á–∞—Å `reconcileTopics` –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É.

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- –ù–µ –≤—ã–∫–ª–∞–¥—ã–≤–∞–π `STRING_SESSION`, `BOT_TOKEN`, `API_HASH` –≤ –ø—É–±–ª–∏—á–Ω—ã–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏.